<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiktak - A Constructed Language</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #1a252f;
            --text: #333;
            --border: #bdc3c7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--light);
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        nav {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 0;
        }

        nav li {
            margin: 0;
        }

        nav a {
            display: block;
            padding: 1rem 2rem;
            text-decoration: none;
            color: var(--primary);
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            cursor: pointer;
        }

        nav a:hover, nav a.active {
            background: var(--light);
            border-bottom-color: var(--secondary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }

        section.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .error {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin: 1rem 0;
        }

        /* Markdown content styling */
        .markdown-content h1 {
            color: var(--primary);
            margin: 2rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            font-size: 2rem;
        }

        .markdown-content h2 {
            color: var(--primary);
            margin: 1.5rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.8rem;
        }

        .markdown-content h3 {
            color: var(--secondary);
            margin: 1.5rem 0 1rem 0;
            font-size: 1.5rem;
        }

        .markdown-content ul, .markdown-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .markdown-content li {
            margin: 0.5rem 0;
        }

        .markdown-content p {
            margin-bottom: 1rem;
        }

        .markdown-content code {
            background: var(--light);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .markdown-content strong {
            color: var(--primary);
            font-weight: 600;
        }

        .markdown-content blockquote {
            background: var(--light);
            border-left: 4px solid var(--secondary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            font-style: italic;
            color: #555;
        }

        .markdown-content pre {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .markdown-content pre code {
            background: transparent;
            padding: 0;
        }

        /* Search box */
        .search-box {
            margin: 1.5rem 0;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            transition: border-color 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        /* Analysis charts */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            border-left: 4px solid var(--secondary);
        }

        .stat-card h3 {
            color: var(--primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
        }

        .chart-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .chart-container h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        footer {
            text-align: center;
            padding: 2rem;
            background: var(--dark);
            color: white;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }

            nav a {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .container {
                padding: 1rem;
            }

            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Tiktak</h1>
        <p>tik-tak: A Rhythmic Constructed Language</p>
    </header>

    <nav>
        <ul>
            <li><a class="nav-link active" data-section="home">Home</a></li>
            <li><a class="nav-link" data-section="dictionary">Dictionary</a></li>
            <li><a class="nav-link" data-section="examples">Examples</a></li>
            <li><a class="nav-link" data-section="grammar">Grammar</a></li>
            <li><a class="nav-link" data-section="poetry">Poetry</a></li>
            <li><a class="nav-link" data-section="analysis">Analysis</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="home" class="active">
            <div class="loading">Loading content...</div>
        </section>

        <section id="dictionary">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search for words... (e.g., 'speak', 'tal', 'house')">
            </div>
            <div id="dictionaryContent" class="markdown-content">
                <div class="loading">Loading dictionary...</div>
            </div>
        </section>

        <section id="examples">
            <div class="markdown-content">
                <div class="loading">Loading examples...</div>
            </div>
        </section>

        <section id="grammar">
            <div class="markdown-content">
                <div class="loading">Loading grammar...</div>
            </div>
        </section>

        <section id="poetry">
            <div class="markdown-content">
                <div class="loading">Loading poetry collection...</div>
            </div>
        </section>

        <section id="analysis">
            <div class="error">
                <h3>About This Analysis</h3>
                <p>This visualization analyzes the phoneme frequency distribution in Tiktak's core vocabulary. It shows which consonants and vowels are most commonly used, and where they appear in words (initial, medial, or final position).</p>
                <p><strong>Note:</strong> Charts auto-update when you edit <code>dictionary.md</code>!</p>
            </div>

            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <h3>Loading...</h3>
                    <div class="value">‚è≥</div>
                </div>
            </div>

            <div class="chart-container">
                <h2>Consonant Frequency</h2>
                <div class="chart-wrapper">
                    <canvas id="consonantChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>Vowel Frequency</h2>
                <div class="chart-wrapper">
                    <canvas id="vowelChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>Phoneme Position Distribution</h2>
                <div class="chart-wrapper">
                    <canvas id="positionChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2>Syllable Structure Distribution</h2>
                <div class="chart-wrapper">
                    <canvas id="syllableChart"></canvas>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 Tiktak Language Project | A constructed language for clarity and simplicity</p>
    </footer>

    <script>
        // Function to switch sections
        function switchSection(sectionId) {
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(l => {
                l.classList.remove('active');
                if (l.getAttribute('data-section') === sectionId) {
                    l.classList.add('active');
                }
            });

            // Show/hide sections
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');

            // Save to localStorage
            localStorage.setItem('kintal-active-section', sectionId);
        }

        // Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('data-section');
                switchSection(targetId);
            });
        });

        // Restore last active section on page load
        function restoreActiveSection() {
            const savedSection = localStorage.getItem('kintal-active-section') || 'home';
            switchSection(savedSection);
        }

        // Load markdown file and render
        async function loadMarkdown(file) {
            try {
                const response = await fetch(file);
                if (!response.ok) throw new Error(`Failed to fetch ${file}`);
                const text = await response.text();
                return marked.parse(text);
            } catch (error) {
                console.error(`Error loading ${file}:`, error);
                return `<div class="error"><h3>Error</h3><p>Could not load ${file}. Make sure you're running a local server.</p></div>`;
            }
        }

        // Load all content
        async function loadContent() {
            // Load README for home
            const homeContent = await loadMarkdown('README.md');
            document.querySelector('#home').innerHTML = `<div class="markdown-content">${homeContent}</div>`;

            // Intercept clicks on .md links in home section
            document.querySelector('#home').addEventListener('click', function(e) {
                if (e.target.tagName === 'A' && e.target.href.endsWith('.md')) {
                    e.preventDefault();
                    const filename = e.target.href.split('/').pop().replace('.md', '');
                    // Map filenames to section IDs
                    const sectionMap = {
                        'dictionary': 'dictionary',
                        'examples': 'examples',
                        'grammar': 'grammar',
                        'phonology': 'grammar',
                        'poetry_collection': 'poetry'
                    };
                    const sectionId = sectionMap[filename];
                    if (sectionId) {
                        switchSection(sectionId);
                    }
                }
            });

            // Load dictionary
            const dictionaryContent = await loadMarkdown('dictionary.md');
            document.querySelector('#dictionaryContent').innerHTML = dictionaryContent;

            // Load examples
            const examplesContent = await loadMarkdown('examples.md');
            document.querySelector('#examples .markdown-content').innerHTML = examplesContent;

            // Load grammar + phonology
            const grammarContent = await loadMarkdown('grammar.md');
            const phonologyContent = await loadMarkdown('phonology.md');
            document.querySelector('#grammar .markdown-content').innerHTML = phonologyContent + grammarContent;

            // Load poetry collection
            const poetryContent = await loadMarkdown('poetry_collection.md');
            document.querySelector('#poetry .markdown-content').innerHTML = poetryContent;
        }

        // Dictionary search
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const content = document.getElementById('dictionaryContent');

            if (searchTerm === '') {
                // Reset: show everything
                content.querySelectorAll('*').forEach(el => el.style.display = '');
                return;
            }

            // Hide all paragraphs (notes) during search
            content.querySelectorAll('p').forEach(p => p.style.display = 'none');

            // Filter list items
            const items = content.querySelectorAll('li');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? '' : 'none';
            });

            // Hide headers with no visible items
            content.querySelectorAll('h2, h3').forEach(header => {
                let nextEl = header.nextElementSibling;
                let hasVisibleItems = false;

                // Check siblings until next header
                while (nextEl && !['H2', 'H3'].includes(nextEl.tagName)) {
                    if (nextEl.tagName === 'UL') {
                        const visibleItems = nextEl.querySelectorAll('li:not([style*="display: none"])');
                        if (visibleItems.length > 0) {
                            hasVisibleItems = true;
                            break;
                        }
                    }
                    nextEl = nextEl.nextElementSibling;
                }

                header.style.display = hasVisibleItems ? '' : 'none';
            });
        });

        // Phoneme analysis
        const consonants = ['p', 'b', 't', 'd', 'g', 'k', 'm', 'n', 's', 'f', 'l', 'r', 'h', 'v'];
        const vowels = ['a', 'e', 'i', 'o', 'u'];

        async function loadVocabulary() {
            try {
                const response = await fetch('dictionary.md');
                const text = await response.text();
                const wordMatches = text.matchAll(/\*\*([a-z]+)\*\*/g);
                const vocabulary = [...new Set([...wordMatches].map(match => match[1]))];
                console.log(`Loaded ${vocabulary.length} words from dictionary.md`);
                return vocabulary;
            } catch (error) {
                console.error('Error loading dictionary:', error);
                return [];
            }
        }

        function analyzePhonemes(vocabulary) {
            const consonantCount = {};
            const vowelCount = {};
            const positionCount = { initial: {}, medial: {}, final: {} };
            const syllableStructures = {};
            let totalPhonemes = 0;

            consonants.forEach(c => {
                consonantCount[c] = 0;
                positionCount.initial[c] = 0;
                positionCount.medial[c] = 0;
                positionCount.final[c] = 0;
            });
            vowels.forEach(v => {
                vowelCount[v] = 0;
                positionCount.initial[v] = 0;
                positionCount.medial[v] = 0;
                positionCount.final[v] = 0;
            });

            vocabulary.forEach(word => {
                const structure = word.split('').map(char =>
                    vowels.includes(char) ? 'V' : 'C'
                ).join('');
                syllableStructures[structure] = (syllableStructures[structure] || 0) + 1;

                for (let i = 0; i < word.length; i++) {
                    const char = word[i];
                    totalPhonemes++;

                    if (consonants.includes(char)) {
                        consonantCount[char]++;
                        if (i === 0) positionCount.initial[char]++;
                        else if (i === word.length - 1) positionCount.final[char]++;
                        else positionCount.medial[char]++;
                    } else if (vowels.includes(char)) {
                        vowelCount[char]++;
                        if (i === 0) positionCount.initial[char]++;
                        else if (i === word.length - 1) positionCount.final[char]++;
                        else positionCount.medial[char]++;
                    }
                }
            });

            return {
                consonantCount,
                vowelCount,
                positionCount,
                syllableStructures,
                totalPhonemes,
                totalWords: vocabulary.length
            };
        }

        function generateCharts(analysis) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>Total Root Words</h3>
                    <div class="value">${analysis.totalWords}</div>
                </div>
                <div class="stat-card">
                    <h3>Total Phonemes</h3>
                    <div class="value">${analysis.totalPhonemes}</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Word Length</h3>
                    <div class="value">${(analysis.totalPhonemes / analysis.totalWords).toFixed(1)}</div>
                </div>
            `;

            const chartConfig = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                }
            };

            new Chart(document.getElementById('consonantChart'), {
                type: 'bar',
                data: {
                    labels: consonants,
                    datasets: [{
                        label: 'Frequency',
                        data: consonants.map(c => analysis.consonantCount[c]),
                        backgroundColor: '#3498db',
                        borderColor: '#2c3e50',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 5 }
                        }
                    }
                }
            });

            new Chart(document.getElementById('vowelChart'), {
                type: 'bar',
                data: {
                    labels: vowels,
                    datasets: [{
                        label: 'Frequency',
                        data: vowels.map(v => analysis.vowelCount[v]),
                        backgroundColor: '#e74c3c',
                        borderColor: '#c0392b',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 10 }
                        }
                    }
                }
            });

            const allPhonemes = [...consonants, ...vowels];
            const phonemeFreq = allPhonemes.map(p => ({
                phoneme: p,
                total: (analysis.consonantCount[p] || 0) + (analysis.vowelCount[p] || 0)
            })).sort((a, b) => b.total - a.total).slice(0, 10);

            new Chart(document.getElementById('positionChart'), {
                type: 'bar',
                data: {
                    labels: phonemeFreq.map(p => p.phoneme),
                    datasets: [
                        {
                            label: 'Initial',
                            data: phonemeFreq.map(p => analysis.positionCount.initial[p.phoneme]),
                            backgroundColor: '#3498db'
                        },
                        {
                            label: 'Medial',
                            data: phonemeFreq.map(p => analysis.positionCount.medial[p.phoneme]),
                            backgroundColor: '#2ecc71'
                        },
                        {
                            label: 'Final',
                            data: phonemeFreq.map(p => analysis.positionCount.final[p.phoneme]),
                            backgroundColor: '#e74c3c'
                        }
                    ]
                },
                options: {
                    ...chartConfig,
                    scales: {
                        x: { stacked: true },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });

            const topStructures = Object.entries(analysis.syllableStructures)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            new Chart(document.getElementById('syllableChart'), {
                type: 'doughnut',
                data: {
                    labels: topStructures.map(s => s[0]),
                    datasets: [{
                        data: topStructures.map(s => s[1]),
                        backgroundColor: [
                            '#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6',
                            '#1abc9c', '#34495e', '#e67e22', '#95a5a6', '#d35400'
                        ]
                    }]
                },
                options: {
                    ...chartConfig,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        async function initAnalysis() {
            const vocabulary = await loadVocabulary();
            if (vocabulary.length > 0) {
                const analysis = analyzePhonemes(vocabulary);
                generateCharts(analysis);
            }
        }

        // Initialize everything
        async function init() {
            await loadContent();
            await initAnalysis();
            restoreActiveSection();
        }

        init();
    </script>
</body>
</html>
